{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "padding": {"right": 20, "bottom": 5, "top": 8},
  "vconcat": [
    {
      "width": "container",
      "height": 520,
      "projection": {"type": "mercator"},
      "title": {
        "text": ["Dengue Cases in Malaysia â€” Proportional Symbol Map"],
        "font": "Segoe UI",
        "fontSize": 17,
        "anchor": "middle",
        "frame": "bounds"
      },
      "layer": [
        {
          "data": {
            "url": "https://raw.githubusercontent.com/Somkiet0126/FIT3179-Assignment-2/main/map_malaysia.topojson",
            "format": {"type": "topojson", "feature": "ne_10m_graticules_1"}
          },
          "mark": {
            "type": "geoshape",
            "filled": false,
            "stroke": "#d1d5db",
            "strokeWidth": 0.6
          }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/Somkiet0126/FIT3179-Assignment-2/main/map_malaysia.topojson",
            "format": {"type": "topojson", "feature": "my"}
          },
          "mark": {"type": "geoshape", "fill": "#eef2f7"}
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/Somkiet0126/FIT3179-Assignment-2/main/map_malaysia.topojson",
            "format": {"type": "topojson", "feature": "my"}
          },
          "mark": {
            "type": "geoshape",
            "filled": false,
            "stroke": "#ffffff",
            "strokeWidth": 2.2
          }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/Somkiet0126/FIT3179-Assignment-2/main/map_malaysia.topojson",
            "format": {"type": "topojson", "feature": "my"}
          },
          "mark": {
            "type": "geoshape",
            "filled": false,
            "stroke": "#334155",
            "strokeWidth": 0.9
          }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/Somkiet0126/FIT3179-Assignment-2/main/denggi_dataset.csv",
            "format": {
              "type": "csv",
              "parse": {"Year": "number", "Cases": "number"}
            }
          },
          "transform": [
            {"filter": "datum.State != 'MALAYSIA'"},
            {"filter": {"param": "yrbrush"}},
            {
              "aggregate": [{"op": "sum", "field": "Cases", "as": "CasesSum"}],
              "groupby": ["State"]
            },
            {
              "lookup": "State",
              "from": {
                "data": {
                  "values": [
                    {"State": "Perlis", "lon": 100.204, "lat": 6.444},
                    {"State": "Kedah", "lon": 100.368, "lat": 6.126},
                    {"State": "Pulau Pinang", "lon": 100.33, "lat": 5.416},
                    {"State": "Perak", "lon": 101.09, "lat": 4.592},
                    {"State": "Selangor", "lon": 101.518, "lat": 3.073},
                    {"State": "W.P. Kuala Lumpur", "lon": 101.687, "lat": 3.14},
                    {"State": "Negeri Sembilan", "lon": 102.247, "lat": 2.725},
                    {"State": "Melaka", "lon": 102.25, "lat": 2.189},
                    {"State": "Johor", "lon": 103.577, "lat": 1.85},
                    {"State": "Pahang", "lon": 102.314, "lat": 3.812},
                    {"State": "Terengganu", "lon": 103.137, "lat": 5.329},
                    {"State": "Kelantan", "lon": 102, "lat": 5.444},
                    {"State": "Sarawak", "lon": 112.5, "lat": 2.5},
                    {"State": "Sabah", "lon": 117.075, "lat": 5.978},
                    {"State": "W.P. Labuan", "lon": 115.241, "lat": 5.283}
                  ]
                },
                "key": "State",
                "fields": ["lon", "lat"]
              }
            },
            {"filter": "isValid(datum.lon) && isValid(datum.lat)"}
          ],
          "mark": {
            "type": "circle",
            "opacity": 0.85,
            "stroke": "#111",
            "strokeWidth": 0.5
          },
          "encoding": {
            "longitude": {"field": "lon"},
            "latitude": {"field": "lat"},
            "size": {
              "field": "CasesSum",
              "type": "quantitative",
              "title": "Cases (sum in selection)",
              "scale": {"type": "sqrt", "range": [40, 2000], "zero": false},
              "legend": {
                "orient": "right",
                "direction": "vertical",
                "offset": 24,
                "padding": 8
              }
            },
            "color": {"value": "#2563eb"},
            "tooltip": [
              {"field": "State", "title": "State"},
              {"field": "CasesSum", "title": "Cases (sum)", "format": ","}
            ]
          }
        }
      ]
    },
    {
      "width": "container",
      "height": 120,
      "title": {
        "text": "Drag on this area chart to filter by year(s)",
        "font": "Segoe UI",
        "fontSize": 12,
        "fontWeight": "bold",
        "anchor": "middle",
        "offset": 6
      },
      "data": {
        "url": "https://raw.githubusercontent.com/Somkiet0126/FIT3179-Assignment-2/main/denggi_dataset.csv",
        "format": {
          "type": "csv",
          "parse": {"Year": "number", "Cases": "number"}
        }
      },
      "transform": [
        {"filter": "datum.State != 'MALAYSIA'"},
        {
          "aggregate": [{"op": "sum", "field": "Cases", "as": "TotalCases"}],
          "groupby": ["Year"]
        }
      ],
      "mark": {"type": "area", "opacity": 0.6, "line": true},
      "params": [
        {
          "name": "yrbrush",
          "select": {"type": "interval", "encodings": ["x"]},
          "init": {"x": [2018.5, 2019.5]}
        }
      ],
      "encoding": {
        "x": {"field": "Year", "type": "quantitative", "title": "Year"},
        "y": {
          "field": "TotalCases",
          "type": "quantitative",
          "title": "Total cases (all states)"
        },
        "color": {"value": "#64748b"}
      }
    }
  ],
  "config": {"view": {"stroke": null}}
}
